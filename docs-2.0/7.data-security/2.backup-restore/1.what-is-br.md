# What is Backup & Restore

Backup & Restore (BR in short) is a Command-Line Interface (CLI) tool for you to back up data of graph spaces of Nebula Graph and to restore data from the backup files.

## Features

- Supports storing backup files in local disks (SSD or HDD), Alibaba Cloud OSS, and Amazon S3.
- Supports backing up data of a minimum of one graph space.

## Limitations

- Supports Nebula Graph v2.0.0-RC and later versions only.
- Supports full backup, but not incremental backup.
- Supports restoration of data on clusters of the same topologies only.
- SSH login is a required for backup and restoration.
- Does not support Nebula Graph deployed with Docker Compose.

## Implementation

This section introduces how backup and restoration are implemented in the BR.

### Backup

To back up data, the BR sends a backup request to each metad process to trigger the backup process as follows:

1. The SSH login from the BR to the meta and the storage servers is verified. Besides, if a remote storage system such as Amazon S3 or Alibaba Cloud OSS is necessary, its client installation and configuration is verified.

2. The BR sends a request to create backup files.

3. The metad processes are locked.

4. The metad processes block writing to the specified graph spaces.

5. The metad processes send a request to the storaged processes for the snapthot file names.

6. The metad processes scan local RocksDB files and output SST files.

7. The metad processes cancel blocking writing to the graph spaces.

8. The metad processes send responses to the BR with the meta data including:
   - the thrift format, partition information of the graph spaces, and the log commit ID of each partition
   - the snapshot information including the catalog of the snapshots of each storaged process, their SST file names of the meta server, and the backup file names.

9. The metad processes are unlocked.

10. The account on the BR machine logs on via SSH to the meta server where the leader locates and all the storage servers, and backs up files.

11. If Amazon S3 or Alibaba Cloud OSS is used, the BR calls commands to upload files to the remote storage system.

12. The BR sends a request to clean the snapshots from meta servers and storage servers.
  
This figure shows how the backup is implemented.

![The figure shows the backup procedure](../../figs/ng-ug-001.png "Implementation of backup")

When backup files are generated, the file names are generated automatically. A file name is in the format of `BACKUP_YY_MM_DD_HH_mm_SS`, of which,

- `BACKUP`: Indicats the files are bakup files.
- `YY_MM_DD_HH_mm_SS`: Indicates the timestamp when the file is generated.

### Restore

The restoration process is implemented as follows:

1. The SSH login from the BR to the meta and the storage servers is verified. Besides, if remote storage system such as Amazon S3 or Alibaba Cloud OSS is necessary, their client installation and configuration is verified.

2. The BR downloads the meta data of the backup files from the remote storage system or other external storage system.

3. The BR verifies the topology of the cluster.

4. The BR stops the Meta Service and the Storage Service remotely.

5. The account on the BR machine logs on via SSH to the meta and storage servers to remove the existing data files.

6. When data files are removed, the account on the BR machine logs on via SSH to the meta and storage servers and downloads the backup files from the remote storage system or other external storage systems.

7. When the backup files are downloaded, the BR starts the Meta Service.

8. The BR calls the `br restore` command to change the partition information of the specified metad processes.

9. The BR starts the Storage Service.

This figure shows how the restoration process is implemented.

![The figures shows the restoration process](../../figs/ng-ug-002.png "Implementation of restoration")

## How to use

To use the BR, follow these steps:

1. [Compile BR](2.compile-br.md).
2. [Use BR to back up data](3.br-backup-data.md).
3. [Use BR to restore data from backup files](4.br-restore-data.md).
